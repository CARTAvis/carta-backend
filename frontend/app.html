<!DOCTYPE HTML>
<html>
<head>
    <title>c++ WS test</title>
    <script type="text/javascript" src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="http://benalman.com/code/projects/jquery-throttle-debounce/jquery.ba-throttle-debounce.js"></script>
    <script id="vs" type="x-shader/x-vertex">
        //Data from bufferData
            attribute vec3 aVertexPosition;
            attribute vec2 aVertexUV;

            //uniform vec2 uViewportSize;

            //These will be passed to the fragment shader and will be interpreted per
            //pixel
            varying vec2 vUV;

            void main(void) {
                //The line below will ignore any translation of perspective matrix
                gl_Position =  vec4(aVertexPosition, 1.0);
                vUV = aVertexUV;
            }


    </script>
    <script id="cmap-rgba" type="x-shader/x-fragment">
        precision highp float;
        uniform vec2 uViewportSize;
        varying vec2 vUV;
        uniform sampler2D u_texture;

        uniform float uMinVal;
        uniform float uMaxVal;
        uniform vec4 uMinCol;
        uniform vec4 uMaxCol;

        float unpackRGBA(vec4 rgba)
        {
          rgba *= 255.0;
          float v = (rgba.b / 2.0) + (rgba.g * 128.0) + (rgba.r * 32768.0);
          //float s = (mod(float(u.b), 2.0)>0.5 ? -1.0 : 1.0);
          return (1.0 + v * pow(2.0, -23.0)) * pow(2.0, rgba.a - 127.0);
        }

        void main(void) {

            vec4 deltaCol = uMaxCol - uMinCol;
            float range = uMaxVal-uMinVal;
            float zVal = unpackRGBA(texture2D(u_texture, vUV));
            float alpha = clamp((zVal - uMinVal) / range, 0.0, 1.0);
            //alpha = sqrt(alpha);
            //alpha = floor(alpha*5.0)/5.0;
            gl_FragColor = uMinCol + alpha * deltaCol;
        }

    </script>

    <script id="cmap-float" type="x-shader/x-fragment">
        precision highp float;
        uniform vec2 uViewportSize;
        varying vec2 vUV;
        uniform sampler2D u_texture;

        uniform float uMinVal;
        uniform float uMaxVal;
        uniform vec4 uMinCol;
        uniform vec4 uMaxCol;

        float unpackRGBA(vec4 rgba)
        {
          rgba *= 255.0;
          float v = (rgba.b / 2.0) + (rgba.g * 128.0) + (rgba.r * 32768.0);
          //float s = (mod(float(u.b), 2.0)>0.5 ? -1.0 : 1.0);
          return (1.0 + v * pow(2.0, -23.0)) * pow(2.0, rgba.a - 127.0);
        }

        void main(void) {

            vec4 deltaCol = uMaxCol - uMinCol;
            float range = uMaxVal-uMinVal;
            float zVal = texture2D(u_texture, vUV).r;

            float alpha = clamp((zVal - uMinVal) / range, 0.0, 1.0);
            //alpha = sqrt(alpha);
            //alpha = floor(alpha*5.0)/5.0;
            gl_FragColor = uMinCol + alpha * deltaCol;
        }

    </script>
    <script async type="text/javascript" src="encodeFloats.js"></script>
    <script type="text/javascript" src="./app.js"></script>
</head>
<body>
<!--<canvas id="heatmap" width="1000" height="500"></canvas>-->
<canvas id="webgl" width="1000" height="500"></canvas>
<p id="cursor"></p>
<div id="slidecontainer">
    <p>Min value:</p>
    <input type="range" min="0" max="20.0" value="2.5" step="0.1" id="min_val">
    <input type="color" value="#000000" id="min_col">
    <p>Max value:</p>
    <input type="range" min="0.0" max="20.0" value="6.5" step="0.1" id="max_val">
    <input type="color" value="#FFFFFF" id="max_col">
</div>
<h2>Send:</h2>
<form id="region" method="POST" action='#'>
    <label for="mip_val">Mipmap level (1-1024):</label>
    <input type="number" min=1 step=1 name="mip_val" id="mip_val" value=1><br>
    <label for="compression_val">Compression level (4-32):</label>
    <input type="number" step=1 name="compression_val" id="compression_val" value=-1><br>
    <label for="band_val">Band:</label>
    <input type="number" min=0 step=1 name="band_val" id="band_val" value=0><br>
    <label for="x_val">X:</label>
    <input type="number" min=0 step=1 name="x_val" id="x_val" value=4000><br>
    <label for="y_val">Y:</label>
    <input type="number" min=0 step=1 name="y_val" id="y_val" value=500><br>
    <label for="w_val">Width:</label>
    <input type="number" min=1 step=1 name="w_val" id="w_val" value=1000><br>
    <label for="h_val">Height:</label>
    <input type="number" min=1 step=1 name="h_val" id="h_val" value=500><br><br>
    <input type="submit" value="Request Region">
</form>
<br><br>
<form id="fileload" method="POST" action='#'>
    <input type="text" name="fileload_data" id="fileload_data" value="GALFACTS_N4_0263_4023_10chanavg_I.hdf5">
    <input type="submit" value="Load File">
</form>
<form id="disconnect" method="POST" action="#">
    <input type="submit" value="Disconnect">
</form>
<h2>Receive:</h2>
<div><p id="log"></p></div>
</body>
</html>
