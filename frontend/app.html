<!DOCTYPE HTML>
<html>
<head>
    <title>c++ WS test</title>
    <script type="text/javascript" src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="http://benalman.com/code/projects/jquery-throttle-debounce/jquery.ba-throttle-debounce.js"></script>
    <script type="text/javascript" src="./jscolor.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script id="vs" type="x-shader/x-vertex">
        //Data from bufferData
            attribute vec3 aVertexPosition;
            attribute vec2 aVertexUV;

            //uniform vec2 uViewportSize;

            //These will be passed to the fragment shader and will be interpreted per
            //pixel
            varying vec2 vUV;

            void main(void) {
                //The line below will ignore any translation of perspective matrix
                gl_Position =  vec4(aVertexPosition, 1.0);
                vUV = aVertexUV;
            }









    </script>
    <script id="cmap-rgba" type="x-shader/x-fragment">
        precision highp float;
        uniform vec2 uViewportSize;
        varying vec2 vUV;
        uniform sampler2D u_texture;

        uniform float uMinVal;
        uniform float uMaxVal;
        uniform vec4 uMinCol;
        uniform vec4 uMaxCol;

        float unpackRGBA(vec4 rgba)
        {
          rgba *= 255.0;
          float v = (rgba.b / 2.0) + (rgba.g * 128.0) + (rgba.r * 32768.0);
          //float s = (mod(float(rgba.b), 2.0)>0.5 ? -1.0 : 1.0);
          return 1.0*(1.0 + v * pow(2.0, -23.0)) * pow(2.0, rgba.a - 127.0);
        }

        void main(void) {

            vec4 deltaCol = uMaxCol - uMinCol;
            float range = uMaxVal-uMinVal;
            float zVal = unpackRGBA(texture2D(u_texture, vUV));
            float alpha = clamp((zVal - uMinVal) / range, 0.0, 1.0);
            //alpha = sqrt(alpha);
            //alpha = floor(alpha*5.0)/5.0;
            gl_FragColor = uMinCol + alpha * deltaCol;
        }





    </script>
    <script id="cmap-float" type="x-shader/x-fragment">
        precision highp float;
        uniform vec2 uViewportSize;
        varying vec2 vUV;
        uniform sampler2D u_texture;

        uniform float uMinVal;
        uniform float uMaxVal;
        uniform vec4 uMinCol;
        uniform vec4 uMaxCol;

        void main(void) {

            vec4 deltaCol = uMaxCol - uMinCol;
            float range = uMaxVal-uMinVal;
            float zVal = texture2D(u_texture, vUV).r;

            float alpha = clamp((zVal - uMinVal) / range, 0.0, 1.0);
            //alpha = sqrt(alpha);
            //alpha = floor(alpha*5.0)/5.0;
            gl_FragColor = uMinCol + alpha * deltaCol;
        }





    </script>
    <script type="text/javascript" src="encodeFloats.js"></script>
    <script type="text/javascript" src="./app.js"></script>
</head>
<body>
<table>
    <tr>
        <td>
            <div id="container" style="position:relative; width: 768px; height: 768px">
                <canvas id="webgl" width="768" height="768" style="position: absolute; pointer: none"></canvas>
                <canvas id="overlay" width="768" height="768" style="pointer: none; position: absolute; z-index: 1; border: 1px black solid"></canvas>
            </div>
            <p id="cursor"></p>
        </td>
        <td style="width:100px"></td>
        <td>
            <br><br>
            <form id="fileload" method="POST" action='#'>
                <input type="text" name="fileload_data" id="fileload_data" value="GALFACTS_N4_0263_4023_10chanavg_I.hdf5">
                <input type="submit" value="Load File">
            </form>
            <form id="disconnect" method="POST" action="#">
                <input type="submit" value="Disconnect">
            </form>
            <label for="compression_val">Compression level (4-32):</label>
            <input type="number" step=1 name="compression_val" id="compression_val" value=12><br>
            <label for="band_val">Band:</label>
            <input type="range" min="0" max="100" value="0" step="0" id="band_val"><br>
            <!--<input type="number" min=0 step=1 name="band_val" id="band_val" value=0><br>-->
            <button id="region">Request Region</button>
            <br><br>
            <table>
                <tr>
                    <td>
                    </td>
                    <td>Current View</td>
                    <td>Required View</td>
                </tr>
                <tr>
                    <td>X</td>
                    <td id="current_view_x">0</td>
                    <td id="req_view_x">0</td>
                </tr>
                <tr>
                    <td>Y</td>
                    <td id="current_view_y">0</td>
                    <td id="req_view_y">0</td>
                </tr>
                <tr>
                    <td>Width</td>
                    <td id="current_view_w">0</td>
                    <td id="req_view_w">0</td>
                </tr>
                <tr>
                    <td>Height</td>
                    <td id="current_view_h">0</td>
                    <td id="req_view_h">0</td>
                </tr>
                <tr>
                    <td>MIP</td>
                    <td id="current_view_mip">0</td>
                    <td id="req_view_mip">0</td>
                </tr>
            </table>


            <form id="view" method="POST" action='#'>
                <label for="centerX">CenterX:</label>
                <input type="number" disabled step=1 name="centerX" id="centerX" value=2925><br>
                <label for="centerY">CenterY:</label>
                <input type="number" disabled step=1 name="centerY" id="centerY" value=537><br>
                <label for="zoomLevel">Zoom:</label>
                <input type="number" disabled step=0.0025 name="zoomLevel" id="zoomLevel" value=0.170940171><br>
            </form>
            <table>
                <tr>
                    <td>
                        <button id="button_zoom_fit">Fit</button>
                    </td>
                    <td>
                        <button id="button_zoom_200">200%</button>
                    </td>
                    <td>
                        <button id="button_zoom_100">100%</button>
                    </td>
                    <td>
                        <button id="button_zoom_50">50%</button>
                    </td>
                    <td>
                        <button id="button_zoom_33">33%</button>
                    </td>
                    <td>
                        <button id="button_zoom_25">25%</button>
                    </td>

                </tr>
            </table>
            <br>
            <div id="slidecontainer">
                <p>Min value: <span id="min_val_label">3.3</span></p>
                <input type="range" min="0" max="20.0" value="3.3" step="0.1" id="min_val">
                <input class="jscolor" value="#040e21" id="min_col">
                <p>Max value: <span id="max_val_label">5.2</span></p>
                <input type="range" min="0.0" max="20.0" value="5.2" step="0.1" id="max_val">
                <input class="jscolor" value="#ffffff" id="max_col">
            </div>

            <div id="profileX" style="width:100%;height:250px;"></div>
            <div id="profileY" style="width:100%;height:250px;"></div>
        </td>
    </tr>
</table>



</body>
</html>
